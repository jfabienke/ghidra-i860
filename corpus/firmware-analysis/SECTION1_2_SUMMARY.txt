================================================================================
  SECTION 1+2 EXECUTIVE SUMMARY
  NeXTdimension i860 Firmware - Bootstrap & Graphics Library
================================================================================

SIZE:       32 KB (0xF8000000 - 0xF8007FFF)
FUNCTIONS:  81 identified functions
PURPOSE:    Display PostScript graphics acceleration library + bootstrap code

================================================================================
  KEY FINDINGS
================================================================================

1. NOT A MAILBOX PROTOCOL HANDLER
   ❌ Zero mailbox register accesses (no orh 0x0200 instructions)
   ❌ No command/response state machines
   ❌ No status polling loops
   ✅ Pure graphics acceleration library

2. GRAPHICS PRIMITIVES LIBRARY
   ✅ 4.4 KB data region (89.6% zeros - padding/alignment space)
   ✅ Functions sized for graphics operations (4B to 4,172B)
   ✅ Byte-oriented operations (pixel manipulation)
   ✅ Called by Section 3 PostScript interpreter & Section 6

3. HIGHLY OPTIMIZED CODE
   ✅ FP registers used for bulk transfers (doubles capacity)
   ✅ Pipelined loads (ppfld.l) for dual-instruction issue
   ✅ Branch prediction hints (bc.t, bnc.t)
   ✅ Separate paths for aligned/unaligned/small/large ops

4. WELL-STRUCTURED LIBRARY
   ✅ 81 functions with clear boundaries (bri returns)
   ✅ Size range: 4 bytes (stubs) to 4,172 bytes (main dispatcher)
   ✅ Organized by complexity: utilities → primitives → wrappers
   ✅ 22:1 load/store ratio (read-heavy rendering pipeline)

================================================================================
  MEMORY LAYOUT
================================================================================

0xF8000000 │ Sparse Data Region (4.4 KB, 89.6% zeros)
           │ • Bootstrap initialization constants (~500 bytes)
           │ • Padding/alignment space (~3.98 KB)
───────────┼────────────────────────────────────────────────────
0xF8001130 │ Bootstrap Entry Point (280 bytes)
───────────┼────────────────────────────────────────────────────
0xF8001248 │ Graphics Function Library (27.6 KB, 81 functions)
           │   • Stubs/trampolines (7 functions)
           │   • Core utilities (16 functions)
           │   • Graphics primitives (40 functions)
           │   • Advanced wrappers (18 functions)
───────────┼────────────────────────────────────────────────────
0xF8007FFF │ [END OF SECTION]

================================================================================
  NOTABLE FUNCTIONS
================================================================================

Function 11  (0xF8001738)  4,172 bytes  Main Bulk Transfer Dispatcher ★★★
             • Largest function in entire firmware
             • Optimized memcpy/memmove with multiple code paths
             • Performance-critical infrastructure

Function 33  (0xF8005460)  2,536 bytes  Bitmap Blit Engine ★★
             • Second-largest function
             • Core graphics acceleration
             • Heavily used by PostScript renderer

Function 10  (0xF8001664)    212 bytes  Hardware Register Setup ★
             • Initializes i860 control registers
             • Cache, TLB, FP configuration
             • Called during bootstrap

Function 8   (0xF8001248)    864 bytes  Large FP Bulk Transfer
             • Uses FP register file for data movement
             • Quad-word (128-bit) operations
             • First major function after bootstrap

================================================================================
  INSTRUCTION ANALYSIS
================================================================================

Instruction Distribution:
  Memory Ops:     6,189 (75.6%)  ld.b dominates (byte graphics)
  ALU Ops:        1,254 (15.3%)  Address arithmetic
  Branches:         454 (5.5%)   Control flow
  FP Ops:           203 (2.5%)   Bulk data via FP regs
  Calls:             11 (0.1%)   Function calls
  Returns:           81 (1.0%)   Function boundaries (bri)

Load/Store Breakdown:
  ld.b:  4,892  (63%)   Byte-oriented pixel reading
  st.b:    224  (3%)    Pixel writing
  fld.q:    94  (1%)    128-bit bulk loads
  fst.q:    78  (1%)    128-bit bulk stores

  Load:Store Ratio = 22:1 (extremely read-heavy)

================================================================================
  INTEGRATION
================================================================================

CALLED BY:
  • Section 3 (PostScript Interpreter) → Graphics primitives
  • Section 6 (Advanced Graphics)      → Blitting/memory ops
  • ROM Boot Code                      → Bootstrap entry

CALLS TO:
  • ROM Functions (7 calls)            ← Hardware detection, bootstrap
  • Section 3 (0 calls)                ← None observed
  • Section 6 (0 calls)                ← None observed
  • Unknown High Memory (3 calls)      ← May be invalid addresses

CROSS-SECTION INTEGRATION:
  • 87.7% leaf functions (71 of 81)    ← No calls to other code
  • 10 functions call ROM              ← Bootstrap dependencies only
  • Section 3/6 CALL Section 1+2       ← Not vice versa (library pattern)

================================================================================
  ENTRY POINT
================================================================================

Bootstrap Sequence:
  1. ROM loads firmware to 0xF8000000
  2. Execution starts at 0xF8001134 (br instruction)
  3. Calls ROM hardware detection (0x06e111ac)
  4. Conditional setup based on hardware config
  5. Jumps to Function 8 (0xF8001248) or main processing

Primary Entry: 0xF8001134 (bootstrap branch)
Code Start:    0xF8001248 (Function 8 - first major function)

================================================================================
  CALLING CONVENTION (INFERRED)
================================================================================

Arguments:    r8, r9, r10  (observed: src, dst, len patterns)
Return:       r1           (standard i860 convention)
Scratch:      r16-r31      (used freely in most functions)
Preserved:    r1-r15       (likely, needs verification)
FP Regs:      f0-f31       (bulk data only, not arithmetic)

Stack Usage:  Minimal (most functions are leaf or shallow depth)

================================================================================
  WHAT THIS IS NOT
================================================================================

❌ Not a command protocol handler
❌ Not a mailbox polling loop
❌ Not using Mach IPC (msg_send/msg_receive)
❌ Not standalone firmware (needs Section 3 interpreter)
❌ Not ROM code (loaded by ROM into DRAM)

================================================================================
  WHAT THIS IS
================================================================================

✅ Display PostScript graphics acceleration library
✅ Low-level primitives for pixel manipulation
✅ Bulk memory transfer utilities
✅ Hardware initialization routines
✅ Foundation for Section 3 interpreter & Section 6 advanced graphics

================================================================================
  CONFIDENCE LEVEL
================================================================================

Structure:          ████████████████████ 100%  All functions mapped
Function purposes:  ████████████████░░░░  80%  Inferred from patterns
Entry point:        ████████████████░░░░  80%  Bootstrap flow traced
Calling convention: ████████████░░░░░░░░  60%  Pattern-based inference
Integration:        ████████████████░░░░  80%  Cross-section analysis

Overall: HIGH confidence based on direct disassembly evidence

================================================================================
  NEXT STEPS
================================================================================

Priority 1: Analyze Section 3 (PostScript Interpreter)
           • Find main loop and operator dispatch
           • Verify calls into Section 1+2 functions
           • Extract PostScript bytecode format

Priority 2: Understand data section purpose
           • Analyze sparse data region (89.6% zeros)
           • Extract initialization constants (~500 bytes)
           • Determine padding vs functional data

Priority 3: Verify calling convention
           • Trace actual function calls between sections
           • Identify parameter passing patterns
           • Confirm register preservation rules

Priority 4: Cross-reference with Section 6
           • Map function call chains
           • Identify shared utilities
           • Understand advanced graphics dependencies

================================================================================
  REFERENCES
================================================================================

Comprehensive:     SECTION1_2_DEEP_DIVE.md (all 5 deep-dive analyses)
Full Analysis:     SECTION1_2_DETAILED_ANALYSIS.md
Memory Map:        SECTION1_2_MEMORY_MAP.txt
Disassembly:       01_bootstrap_graphics.asm
JSON Data:         ND_i860_VERIFIED_clean.json (instructions 0-8191)

Related Sections:
  Section 3:       02_postscript_operators.bin (PostScript interpreter)
  Section 6:       03_graphics_acceleration.bin (Advanced graphics)
  ROM:             ND_step1_v43_eeprom.bin (Boot ROM, loads firmware)

================================================================================
  VERSION HISTORY
================================================================================

v1.0  2025-11-10  Initial detailed analysis from disassembly
                  - 81 functions identified
                  - Memory map created
                  - Instruction patterns analyzed
                  - Integration documented

v1.1  2025-11-10  Deep-dive analysis updates
                  - Data section found to be 89.6% zeros (padding)
                  - Cross-section call graph mapped (10 calls total)
                  - Hardware register analysis (236 orh, 66 VRAM, 0 mailbox)
                  - Calling convention hypothesis documented (80% confidence)
                  - Library architecture confirmed (87.7% leaf functions)

================================================================================
