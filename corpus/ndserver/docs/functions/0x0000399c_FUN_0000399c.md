# Function Analysis: FUN_0000399c

**Analysis Date**: November 08, 2025
**Tool**: Ghidra 11.2.1 (m68k disassembly)
**Binary**: NDserver (Mach-O m68k executable)

---

## Function Overview

**Address**: `0x0000399c`
**Size**: 832 bytes
**Call Depth**: 2
**Calls Made**: 36 total (5 internal, 27 library, 4 external)
**Called By**: 1 functions

---

## Called By

- `FUN_00002dc6` at `0x00003010`

---

## Complete Disassembly

```asm
; Address: 0x0000399c
; Size: 832 bytes
; ============================================================================
  0x0000399c:  link.w     A6,-0xc
  0x000039a0:  movem.l    {  A4 A3 A2 D7 D6 D5 D4 D3 D2},SP
  0x000039a4:  move.l     (0x8,A6),D6
  0x000039a8:  move.l     (0xc,A6),D7
  0x000039ac:  move.l     (0x10,A6),D4
  0x000039b0:  move.l     (0x14,A6),D5
  0x000039b4:  clr.l      D2
  0x000039b6:  pea        (0x2000).w
  0x000039ba:  lea        (0x50028fa).l,A2
  0x000039c0:  jsr        A2
  0x000039c2:  movea.l    D0,A3
  0x000039c4:  pea        (0x2000).w
  0x000039c8:  jsr        A2
  0x000039ca:  movea.l    D0,A4
  0x000039cc:  bsr.l      0x05003152
  0x000039d2:  move.l     D0,(-0x4,A6)
  0x000039d6:  addq.w     0x8,SP
  0x000039d8:  bne.b      0x00003a1a
  0x000039da:  pea        (-0x4,A6)
  0x000039de:  move.l     (0x04010290).l,-(SP)
  0x000039e4:  bsr.l      0x05002c54
  0x000039ea:  addq.w     0x8,SP
  0x000039ec:  tst.l      D0
  0x000039ee:  beq.b      0x00003a02
  0x000039f0:  move.l     D0,-(SP)
  0x000039f2:  pea        (0x78a7).l
  0x000039f8:  bsr.l      0x050028c4
  0x000039fe:  bra.w      0x00003cd2
  0x00003a02:  move.l     (-0x4,A6),-(SP)
  0x00003a06:  pea        (0x2).w
  0x00003a0a:  move.l     (0x04010290).l,-(SP)
  0x00003a10:  bsr.l      0x05003164
  0x00003a16:  addq.w     0x8,SP
  0x00003a18:  addq.w     0x4,SP
  0x00003a1a:  pea        (-0x8,A6)
  0x00003a1e:  pea        (0x78bc).l
  0x00003a24:  move.l     D7,-(SP)
  0x00003a26:  move.l     D6,-(SP)
  0x00003a28:  bsr.l      0x00004a52                     ; -> FUN_00004a52
  0x00003a2e:  addq.w     0x8,SP
  0x00003a30:  addq.w     0x8,SP
  0x00003a32:  tst.l      D0
  0x00003a34:  bne.b      0x00003a86
  0x00003a36:  tst.l      D4
  0x00003a38:  bne.b      0x00003a86
  0x00003a3a:  pea        (0x4000).w
  0x00003a3e:  bsr.l      0x05002f72
  0x00003a44:  clr.l      -(SP)
  0x00003a46:  clr.l      -(SP)
  0x00003a48:  pea        (0x78c8).l
  0x00003a4e:  bsr.l      0x05002bc4
  0x00003a54:  movea.l    D0,A2
  0x00003a56:  addq.w     0x8,SP
  0x00003a58:  addq.w     0x8,SP
  0x00003a5a:  moveq      -0x1,D1
  0x00003a5c:  cmp.l      A2,D1
  0x00003a5e:  beq.b      0x00003a7c
  0x00003a60:  clr.l      -(SP)
  0x00003a62:  move.l     #0x20007471,-(SP)
  0x00003a68:  move.l     A2,-(SP)
  0x00003a6a:  bsr.l      0x050027ce
  0x00003a70:  move.l     A2,-(SP)
  0x00003a72:  bsr.l      0x0500229a
  0x00003a78:  addq.w     0x8,SP
  0x00003a7a:  addq.w     0x8,SP
  0x00003a7c:  bsr.l      0x05002696
  0x00003a82:  move.l     D0,D2
  0x00003a84:  bra.b      0x00003a8a
  0x00003a86:  clr.l      (-0x8,A6)
  0x00003a8a:  pea        (-0xc,A6)
  0x00003a8e:  move.l     (0x04010290).l,-(SP)
  0x00003a94:  bsr.l      0x05002c96
  0x00003a9a:  addq.w     0x8,SP
  0x00003a9c:  tst.l      D0
  0x00003a9e:  beq.b      0x00003ab2
  0x00003aa0:  move.l     D0,-(SP)
  0x00003aa2:  pea        (0x78d1).l
  0x00003aa8:  bsr.l      0x050028c4
  0x00003aae:  bra.w      0x00003cd2
  0x00003ab2:  tst.l      D4
  0x00003ab4:  beq.b      0x00003ae2
  0x00003ab6:  move.l     D4,-(SP)
  0x00003ab8:  move.l     (-0xc,A6),-(SP)
  0x00003abc:  move.l     (0x04010290).l,-(SP)
  0x00003ac2:  bsr.l      0x05002c90
  0x00003ac8:  addq.w     0x8,SP
  0x00003aca:  addq.w     0x4,SP
  0x00003acc:  tst.l      D0
  0x00003ace:  beq.b      0x00003ae2
  0x00003ad0:  move.l     D0,-(SP)
  0x00003ad2:  pea        (0x78ea).l
  0x00003ad8:  bsr.l      0x050028c4
  0x00003ade:  bra.w      0x00003cd2
  0x00003ae2:  tst.l      D5
  0x00003ae4:  beq.b      0x00003b4e
  0x00003ae6:  move.l     D5,-(SP)
  0x00003ae8:  move.l     (-0xc,A6),-(SP)
  0x00003aec:  move.l     (0x04010290).l,-(SP)
  0x00003af2:  bsr.l      0x05002c90
  0x00003af8:  addq.w     0x8,SP
  0x00003afa:  addq.w     0x4,SP
  0x00003afc:  tst.l      D0
  0x00003afe:  beq.b      0x00003b12
  0x00003b00:  move.l     D0,-(SP)
  0x00003b02:  pea        (0x7906).l
  0x00003b08:  bsr.l      0x050028c4
  0x00003b0e:  bra.w      0x00003cd2
  0x00003b12:  move.l     D7,-(SP)
  0x00003b14:  move.l     D6,-(SP)
  0x00003b16:  bsr.l      0x00006474                     ; -> FUN_00006474
  0x00003b1c:  move.l     D0,D3
  0x00003b1e:  addq.w     0x8,SP
  0x00003b20:  beq.b      0x00003b4e
  0x00003b22:  move.l     D3,-(SP)
  0x00003b24:  move.l     (-0xc,A6),-(SP)
  0x00003b28:  move.l     (0x04010290).l,-(SP)
  0x00003b2e:  bsr.l      0x05002c90
  0x00003b34:  addq.w     0x8,SP
  0x00003b36:  addq.w     0x4,SP
  0x00003b38:  tst.l      D0
  0x00003b3a:  beq.b      0x00003b4e
  0x00003b3c:  move.l     D0,-(SP)
  0x00003b3e:  pea        (0x7922).l
  0x00003b44:  bsr.l      0x050028c4
  0x00003b4a:  bra.w      0x00003cd2
  0x00003b4e:  tst.l      (-0x4,A6)
  0x00003b52:  beq.b      0x00003b82
  0x00003b54:  move.l     (-0x4,A6),-(SP)
  0x00003b58:  move.l     (-0xc,A6),-(SP)
  0x00003b5c:  move.l     (0x04010290).l,-(SP)
  0x00003b62:  bsr.l      0x05002c90
  0x00003b68:  addq.w     0x8,SP
  0x00003b6a:  addq.w     0x4,SP
  0x00003b6c:  tst.l      D0
  0x00003b6e:  beq.b      0x00003b82
  0x00003b70:  move.l     D0,-(SP)
  0x00003b72:  pea        (0x7942).l
  0x00003b78:  bsr.l      0x050028c4
  0x00003b7e:  bra.w      0x00003cd2
  0x00003b82:  move.l     #0x2000,(0x4,A3)
  0x00003b8a:  move.l     (-0xc,A6),(0xc,A3)
  0x00003b90:  clr.l      -(SP)
  0x00003b92:  clr.l      -(SP)
  0x00003b94:  move.l     A3,-(SP)
  0x00003b96:  bsr.l      0x050029ae
  0x00003b9c:  addq.w     0x8,SP
  0x00003b9e:  addq.w     0x4,SP
  0x00003ba0:  tst.l      D0
  0x00003ba2:  beq.b      0x00003bb8
  0x00003ba4:  move.l     D0,-(SP)
  0x00003ba6:  bsr.l      0x050028d0
  0x00003bac:  move.l     D0,-(SP)
  0x00003bae:  pea        (0x795f).l
  0x00003bb4:  bra.w      0x00003cb6
  0x00003bb8:  moveq      0x1,D1
  0x00003bba:  cmp.l      (0x8,A3),D1
  0x00003bbe:  bne.b      0x00003bf4
  0x00003bc0:  moveq      0x41,D1
  0x00003bc2:  cmp.l      (0x14,A3),D1
  0x00003bc6:  beq.b      0x00003bd0
  0x00003bc8:  moveq      0x45,D1
  0x00003bca:  cmp.l      (0x14,A3),D1
  0x00003bce:  bne.b      0x00003bde
  0x00003bd0:  move.l     (0x1c,A3),D1
  0x00003bd4:  cmp.l      (-0x8,A6),D1
  0x00003bd8:  beq.w      0x00003cc4
  0x00003bdc:  bra.b      0x00003b82
  0x00003bde:  move.l     (0x14,A3),-(SP)
  0x00003be2:  pea        (0x798e).l
  0x00003be8:  bsr.l      0x05002ce4
  0x00003bee:  addq.w     0x8,SP
  0x00003bf0:  bra.w      0x00003cc4
  0x00003bf4:  cmp.l      (0xc,A3),D4
  0x00003bf8:  bne.b      0x00003c10
  0x00003bfa:  tst.l      (0x10,A3)
  0x00003bfe:  bne.b      0x00003c04
  0x00003c00:  move.l     D6,(0x10,A3)
  0x00003c04:  move.l     A4,-(SP)
  0x00003c06:  move.l     A3,-(SP)
  0x00003c08:  bsr.l      0x00006e6c                     ; -> FUN_00006e6c
  0x00003c0e:  bra.b      0x00003c6a
  0x00003c10:  cmp.l      (0xc,A3),D5
  0x00003c14:  bne.b      0x00003c3e
  0x00003c16:  move.l     A4,-(SP)
  0x00003c18:  move.l     A3,-(SP)
  0x00003c1a:  bsr.l      0x000033b4                     ; -> FUN_000033b4
  0x00003c20:  addq.w     0x8,SP
  0x00003c22:  tst.l      D0
  0x00003c24:  bne.b      0x00003c70
  0x00003c26:  tst.l      D2
  0x00003c28:  ble.w      0x00003cc4
  0x00003c2c:  pea        (0x1).w
  0x00003c30:  move.l     D2,-(SP)
  0x00003c32:  bsr.l      0x0500282e
  0x00003c38:  addq.w     0x8,SP
  0x00003c3a:  bra.w      0x00003cc4
  0x00003c3e:  cmp.l      (0xc,A3),D3
  0x00003c42:  beq.b      0x00003c60
  0x00003c44:  move.l     (0x14,A3),-(SP)
  0x00003c48:  move.l     (0xc,A3),-(SP)
  0x00003c4c:  pea        (0x79bb).l
  0x00003c52:  bsr.l      0x05002ce4
  0x00003c58:  addq.w     0x8,SP
  0x00003c5a:  addq.w     0x4,SP
  0x00003c5c:  bra.w      0x00003b82
  0x00003c60:  move.l     A4,-(SP)
  0x00003c62:  move.l     A3,-(SP)
  0x00003c64:  bsr.l      0x00006de4                     ; -> FUN_00006de4
  0x00003c6a:  addq.w     0x8,SP
  0x00003c6c:  tst.l      D0
  0x00003c6e:  beq.b      0x00003cc4
  0x00003c70:  cmpi.l     #-0x131,(0x1c,A4)
  0x00003c78:  beq.w      0x00003b82
  0x00003c7c:  move.l     (0xc,A3),(0xc,A4)
  0x00003c82:  move.l     (0x10,A3),(0x10,A4)
  0x00003c88:  clr.l      -(SP)
  0x00003c8a:  clr.l      -(SP)
  0x00003c8c:  move.l     A4,-(SP)
  0x00003c8e:  bsr.l      0x050029d2
  0x00003c94:  addq.w     0x8,SP
  0x00003c96:  addq.w     0x4,SP
  0x00003c98:  tst.l      D0
  0x00003c9a:  beq.w      0x00003b82
  0x00003c9e:  moveq      -0x66,D1
  0x00003ca0:  cmp.l      D0,D1
  0x00003ca2:  beq.w      0x00003b82
  0x00003ca6:  move.l     D0,-(SP)
  0x00003ca8:  bsr.l      0x050028d0
  0x00003cae:  move.l     D0,-(SP)
  0x00003cb0:  pea        (0x79e3).l
  0x00003cb6:  bsr.l      0x05002ce4
  0x00003cbc:  addq.w     0x8,SP
  0x00003cbe:  addq.w     0x4,SP
  0x00003cc0:  bra.w      0x00003b82
  0x00003cc4:  move.l     A3,-(SP)
  0x00003cc6:  lea        (0x5002546).l,A2
  0x00003ccc:  jsr        A2
  0x00003cce:  move.l     A4,-(SP)
  0x00003cd0:  jsr        A2
  0x00003cd2:  movem.l    -0x30,A6,{  D2 D3 D4 D5 D6 D7 A2 A3 A4}
  0x00003cd8:  unlk       A6
  0x00003cda:  rts
; ============================================================================
```

---

## Hardware Access Analysis

### Hardware Registers Accessed

**SYSTEM_DATA**:
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`
- `0x04010290` (SYSTEM_PORT+0x4) - READ via `move.l`


---

## Calls Made

### Internal Function Calls

- `FUN_00004a52` at `0x00004a52` (called from `0x00003a28`)
- `FUN_00006474` at `0x00006474` (called from `0x00003b16`)
- `FUN_00006e6c` at `0x00006e6c` (called from `0x00003c08`)
- `FUN_000033b4` at `0x000033b4` (called from `0x00003c1a`)
- `FUN_00006de4` at `0x00006de4` (called from `0x00003c64`)

### Library/System Calls

- `0x05003152` (called from `0x000039cc`)
- `0x05002c54` (called from `0x000039e4`)
- `0x050028c4` (called from `0x000039f8`)
- `0x05003164` (called from `0x00003a10`)
- `0x05002f72` (called from `0x00003a3e`)
- `0x05002bc4` (called from `0x00003a4e`)
- `0x050027ce` (called from `0x00003a6a`)
- `0x0500229a` (called from `0x00003a72`)
- `0x05002696` (called from `0x00003a7c`)
- `0x05002c96` (called from `0x00003a94`)
- `0x050028c4` (called from `0x00003aa8`)
- `0x05002c90` (called from `0x00003ac2`)
- `0x050028c4` (called from `0x00003ad8`)
- `0x05002c90` (called from `0x00003af2`)
- `0x050028c4` (called from `0x00003b08`)
- `0x05002c90` (called from `0x00003b2e`)
- `0x050028c4` (called from `0x00003b44`)
- `0x05002c90` (called from `0x00003b62`)
- `0x050028c4` (called from `0x00003b78`)
- `0x050029ae` (called from `0x00003b96`)
- ... and 7 more library calls

### External Calls

- `0x000000a2` (called from `0x000039c0`)
- `0x000000a2` (called from `0x000039c8`)
- `0x000000a2` (called from `0x00003ccc`)
- `0x000000a2` (called from `0x00003cd0`)

---

## Library/System Functions

### Library Functions Called

- `UNKNOWN` at `0x05003152` (used 1x across codebase)
- `UNKNOWN` at `0x05002c54` (used 4x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x05003164` (used 1x across codebase)
- `UNKNOWN` at `0x05002f72` (used 1x across codebase)
- `UNKNOWN` at `0x05002bc4` (used 3x across codebase)
- `UNKNOWN` at `0x050027ce` (used 1x across codebase)
- `UNKNOWN` at `0x0500229a` (used 4x across codebase)
- `UNKNOWN` at `0x05002696` (used 2x across codebase)
- `UNKNOWN` at `0x05002c96` (used 1x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x05002c90` (used 4x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x05002c90` (used 4x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x05002c90` (used 4x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x05002c90` (used 4x across codebase)
- `printf` at `0x050028c4` (used 18x across codebase)
- `UNKNOWN` at `0x050029ae` (used 1x across codebase)
- `UNKNOWN` at `0x050028d0` (used 2x across codebase)
- `fprintf / puts` at `0x05002ce4` (used 7x across codebase)
- `UNKNOWN` at `0x0500282e` (used 2x across codebase)
- `fprintf / puts` at `0x05002ce4` (used 7x across codebase)
- `UNKNOWN` at `0x050029d2` (used 7x across codebase)
- `UNKNOWN` at `0x050028d0` (used 2x across codebase)
- `fprintf / puts` at `0x05002ce4` (used 7x across codebase)

---

## Function Classification

**Type**: Internal Function
**Complexity**: Calls 36 functions
**Hardware Interaction**: Yes

---

## Notes

- This documentation was automatically generated from disassembly analysis
- Function purpose and detailed behavior require manual reverse engineering
- See `FUNCTION_ANALYSIS_EXAMPLE.md` for an example of deep manual analysis

---

## Related Functions

### Calls

### Internal Function Calls

- `FUN_00004a52` at `0x00004a52` (called from `0x00003a28`)
- `FUN_00006474` at `0x00006474` (called from `0x00003b16`)
- `FUN_00006e6c` at `0x00006e6c` (called from `0x00003c08`)
- `FUN_000033b4` at `0x000033b4` (called from `0x00003c1a`)
- `FUN_00006de4` at `0x00006de4` (called from `0x00003c64`)

### Library/System Calls

- `0x05003152` (called from `0x000039cc`)
- `0x05002c54` (called from `0x000039e4`)
- `0x050028c4` (called from `0x000039f8`)
- `0x05003164` (called from `0x00003a10`)
- `0x05002f72` (called from `0x00003a3e`)
- `0x05002bc4` (called from `0x00003a4e`)
- `0x050027ce` (called from `0x00003a6a`)
- `0x0500229a` (called from `0x00003a72`)
- `0x05002696` (called from `0x00003a7c`)
- `0x05002c96` (called from `0x00003a94`)
- ... and 17 more library calls

### External Calls

- `0x000000a2` (called from `0x000039c0`)
- `0x000000a2` (called from `0x000039c8`)
- `0x000000a2` (called from `0x00003ccc`)
- `0x000000a2` (called from `0x00003cd0`)

### Called By

- `FUN_00002dc6` at `0x00003010`

---

*Generated by generate_all_function_docs.py*
