# NDserver Function Analysis Index

**Project**: NeXTSTEP NDserver Driver Reverse Engineering
**Total Functions**: 88 (from Ghidra analysis)
**Analyzed**: 13
**In Progress**: 0
**Remaining**: 75

---

## Analysis Progress

### Completed Analyses (13)

| Address    | Name                         | Size | Complexity  | Documentation |
|------------|------------------------------|------|-------------|---------------|
| 0x000036b2 | ND_RegisterBoardSlot         | 366  | Medium      | [Analysis](functions/000036b2_ND_RegisterBoardSlot.md) |
| 0x00003284 | ND_LoadKernelSegments        | 912  | High        | [Analysis](functions/00003284_ND_LoadKernelSegments.md) |
| 0x000033b4 | ND_MemoryTransferDispatcher  | 608  | High        | [Analysis](functions/000033b4_ND_MemoryTransferDispatcher.md) |
| 0x00006474 | ND_URLFileDescriptorOpen     | 164  | Low-Medium  | [Analysis](functions/00006474_ND_URLFileDescriptorOpen.md) |
| 0x000066dc | ND_MessageHandler_CMD43C     | 220  | Medium-High | [Analysis](functions/000066dc_ND_MessageHandler_CMD43C.md) |
| 0x00006602 | ND_MessageHandler_CMD1EDC    | 218  | Medium      | [Analysis](functions/00006602_ND_MessageHandler_CMD1EDC.md) |
| 0x00006ac2 | ND_MessageHandler_CMD42C     | 186  | Low-Medium  | [Analysis](functions/00006ac2_ND_MessageHandler_CMD42C.md) |
| 0x00006b7c | ND_MessageHandler_CMD434     | 204  | Low-Medium  | [Analysis](functions/00006b7c_ND_MessageHandler_CMD434.md) |
| 0x00006c48 | ND_ValidateMessageType1      | 220  | Medium      | [Analysis](functions/00006c48_ND_ValidateMessageType1.md) |
| 0x00006d24 | ND_ValidateAndExecuteCommand | 192  | Medium-High | [Analysis](functions/00006d24_ND_ValidateAndExecuteCommand.md) |
| 0x00006e6c | ND_MessageDispatcher         | 272  | Medium-High | [Analysis](functions/00006e6c_ND_MessageDispatcher.md) |
| 0x0000709c | ND_ProcessDMATransfer        | 976  | High        | [Analysis](functions/0000709c_ND_ProcessDMATransfer.md) |
| 0x0000746c | ND_WriteBranchInstruction    | 352  | Low-Medium  | [Analysis](functions/0000746c_ND_WriteBranchInstruction.md) |

### Priority Analysis Queue (Critical Leaves)

Functions with high call frequency or critical roles:

| Address  | Name                      | Calls | Priority | Status |
|----------|---------------------------|-------|----------|--------|
| 0x000036b2 | ND_RegisterBoardSlot    | 3     | Critical | ✅ Done |
| 0x0000709c | ND_ProcessDMATransfer   | 3     | Critical | ✅ Done |

### Layer 0 - Leaf Functions (12 remaining)

| Address    | Name                         | Size | Calls | Status  |
|------------|------------------------------|------|-------|---------|
| 0x00006e6c | ND_MessageDispatcher         | 272  | 1     | ✅ Done |
| 0x00006474 | ND_URLFileDescriptorOpen     | 164  | 1     | ✅ Done |
| 0x000033b4 | ND_MemoryTransferDispatcher  | 608  | 1     | ✅ Done |
| 0x00003284 | ND_LoadKernelSegments        | 912  | 1     | ✅ Done |
| 0x0000746c | ND_WriteBranchInstruction    | 352  | 0     | ✅ Done |
| 0x00006d24 | ND_ValidateAndExecuteCommand | 192  | 0     | ✅ Done |
| 0x00006c48 | ND_ValidateMessageType1      | 220  | 0     | ✅ Done |
| 0x00006b7c | ND_MessageHandler_CMD434     | 204  | 0     | ✅ Done |
| 0x00006ac2 | ND_MessageHandler_CMD42C     | 186  | 0     | ✅ Done |
| 0x00006a08 | FUN_00006a08  | ?    | 0     | Pending |
| 0x00006922 | FUN_00006922  | ?    | 0     | Pending |
| 0x00006856 | FUN_00006856  | ?    | 0     | Pending |
| 0x000067b8 | FUN_000067b8  | ?    | 0     | Pending |
| 0x000066dc | ND_MessageHandler_CMD43C     | 220  | 0     | ✅ Done |
| 0x00006602 | ND_MessageHandler_CMD1EDC    | 218  | 0     | ✅ Done |
| 0x00006518 | FUN_00006518  | ?    | 0     | Pending |
| 0x00006156 | FUN_00006156  | ?    | 0     | Pending |
| 0x000060d8 | FUN_000060d8  | ?    | 0     | Pending |
| 0x00006036 | FUN_00006036  | ?    | 0     | Pending |

### Layer 1 - Intermediate Functions (4)

| Address  | Name            | Size | Calls | Status |
|----------|-----------------|------|-------|--------|
| 0x00007072 | FUN_00007072  | ?    | 1     | Pending |
| 0x00007032 | FUN_00007032  | ?    | 1     | Pending |
| 0x00006f94 | FUN_00006f94  | ?    | 1     | Pending |
| 0x0000399c | FUN_0000399c  | ?    | 1     | Pending |

### Layer 2 - Higher Functions (3)

| Address  | Name            | Size | Calls | Status |
|----------|-----------------|------|-------|--------|
| 0x00005af6 | FUN_00005af6  | ?    | 1     | Pending |
| 0x00005bb8 | FUN_00005bb8  | ?    | 0     | Pending |
| 0x00005a3e | FUN_00005a3e  | ?    | 0     | Pending |

### Layer 3 - Root Functions (1)

| Address  | Name            | Size | Calls | Status |
|----------|-----------------|------|-------|--------|
| 0x00002dc6 | FUN_00002dc6  | 662  | 0     | Pending |

### Isolated Functions (59)

Functions not in call graph (may be callbacks, table-driven, or orphaned):
- See `database/analysis_order.json` for complete list

---

## Key Findings Summary

### Protocol Architecture

From completed analyses:

1. **User-Space Driver Model**: NDserver runs in user space, communicates with hardware via Mach IPC
2. **Board Registration**: 80-byte board_info structure managed by slot table at 0x819C
3. **DMA Protocol**: Mach-O based segment descriptors with address translation
4. **Memory Windows**:
   - Host: 0x08000000-0x0BFFFFFF (ND RAM window)
   - ND local: 0x00000000-0x03FFFFFF (actual DRAM)
5. **Endianness Handling**: Byte-swapping support for 68040↔i860 transfers

### Data Structures Discovered

- **nd_board_info_t**: 80 bytes, partially mapped (see 000036b2 analysis)
- **segment_descriptor_t**: Mach-O format (magic 0xFEEDFACE)
- **transfer_descriptor_t**: Variable size, name-based classification

### Global Variables

| Address    | Purpose                     | Size |
|------------|-----------------------------|------|
| 0x00008018 | Segment table base          | ?    |
| 0x0000819C | Board slot table (4 slots)  | 16   |
| 0x04010290 | Global Mach port (runtime)  | 4    |
| 0x040105b0 | Global error code           | 4    |

---

## Analysis Statistics

### Completion Rate: 12.5% (11/88 functions)

**Estimated Time**:
- Average time per function: ~38 minutes (parallel analysis: ~40 min per agent)
- Completed: ~7.0 hours (11 functions)
- Remaining: ~49 hours (77 functions × 38 min)
- **Total project**: ~56 hours (~2 weeks full-time)

**Parallel Analysis Pilot Results**:
- **5 functions completed in parallel**: ~40 minutes wall-clock time
- **Time saved**: ~2.7 hours (3.3 hours sequential → 40 minutes parallel)
- **Speedup**: 5× faster with 5 concurrent agents
- **Quality**: All 5 functions exceeded 800-line minimum (avg: 1088 lines)

### Complexity Distribution

| Complexity  | Count | Percentage |
|-------------|-------|------------|
| High        | 3     | 27%        |
| Medium-High | 3     | 25%        |
| Medium      | 3     | 25%        |
| Low-Medium  | 3     | 25%        |

---

## Next Analysis Targets

Following bottom-up strategy from `docs/ANALYSIS_ORDER.md`:

1. **FUN_00006e6c** - Layer 0, called by 1
2. **FUN_00006474** - Layer 0, called by 1
3. **FUN_000033b4** - Layer 0, called by 1
4. **FUN_00003284** - Layer 0, called by 1
5. **FUN_0000746c** - Layer 0, no callers (may be callback)
6. Continue with remaining Layer 0 functions...

---

## Documentation Templates

All function analyses follow the template established in:
- `docs/FUNCTION_ANALYSIS_EXAMPLE.md`
- `docs/functions/000036b2_ND_RegisterBoardSlot.md`

### Standard Sections:

1. Executive Summary
2. Function Signature
3. Complete Annotated Disassembly
4. Stack Frame Layout
5. Hardware Access
6. OS Functions and Library Calls
7. Reverse-Engineered C Pseudocode
8. Data Structures
9. Call Graph
10. Purpose Classification
11. Error Handling
12. Protocol Integration
13. m68k Architecture Details
14. Analysis Insights
15. Unanswered Questions
16. Related Functions
17. Testing Notes

---

## Cross-References

### By Category

**Board Management**:
- ND_RegisterBoardSlot (0x000036b2)

**Memory/DMA**:
- ND_ProcessDMATransfer (0x0000709c)

**i860 Initialization**:
- ND_WriteBranchInstruction (0x0000746c)

**Message/Command Handling**:
- ND_MessageDispatcher (0x00006e6c) - Jump table dispatcher for types 0-5
- ND_ValidateAndExecuteCommand (0x00006d24) - Validates message and executes commands
- ND_ValidateMessageType1 (0x00006c48) - Validates type 1 messages
- ND_MessageHandler_CMD434 (0x00006b7c) - Handler for command 0x434
- ND_MessageHandler_CMD43C (0x000066dc) - Handler for command 0x43C (8KB transfers)

**Device/File Operations**:
- ND_URLFileDescriptorOpen (0x00006474) - Parse URL and open file descriptor

**Boot Sequence** (discovered order):
1. ND_RegisterBoardSlot - Allocate 80-byte board structure
2. ND_ProcessDMATransfer - Load kernel to i860 memory (Mach-O __TEXT segment)
3. ND_WriteBranchInstruction - Write i860 entry point vector at high memory
4. (Unknown) - Release i860 from reset
5. i860 executes branch → jumps to kernel entry point

**[Other categories to be populated as analysis progresses]**

### By Address Range

| Range           | Count | Status |
|-----------------|-------|--------|
| 0x2000-0x3FFF   | ?     | ?      |
| 0x4000-0x5FFF   | ?     | ?      |
| 0x6000-0x6FFF   | 1     | 1 done |
| 0x7000-0x75F8   | 2     | 2 done |

---

## Revision History

| Date       | Analyst     | Change                              | Functions Added |
|------------|-------------|-------------------------------------|-----------------|
| 2025-11-08 | Claude Code | Initial index creation              | 0               |
| 2025-11-08 | Claude Code | Added ND_RegisterBoardSlot          | 1               |
| 2025-11-08 | Claude Code | Added ND_ProcessDMATransfer         | 1               |
| 2025-11-08 | Claude Code | Added ND_WriteBranchInstruction     | 1               |
| 2025-11-08 | Claude Code | Added ND_MessageDispatcher          | 1               |
| 2025-11-08 | Claude Code | Added ND_URLFileDescriptorOpen      | 1               |

---

**Last Updated**: 2025-11-08
**Maintainer**: Claude Code
**Project Status**: Active Analysis (Phase 3: Deep Manual Analysis)
