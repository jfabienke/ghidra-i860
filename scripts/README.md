# i860 Ghidra Scripts

General-purpose scripts for importing and analyzing i860 binaries in Ghidra.

## Scripts

### DisassembleAll.java

Linear sweep disassembly for **raw binary** imports. BinaryLoader creates byte data that blocks disassembly, so this script clears all existing data first, then disassembles at every 4-byte boundary. Exports results to `/tmp/ghidra_disasm.txt` (configurable via `-Dghidra.export.path=`).

Used for SLEIGH verification against the reference Rust disassembler.

### AnalysisStats.java

Standalone utility that prints analysis statistics: instruction count, function count, data items, and memory block layout. Useful for quick checks in the Ghidra GUI or headless mode.

## Target-Specific Scripts

Analysis scripts for specific binaries live alongside their targets in the `re/` tree:

- [`re/nextdimension/kernel/scripts/`](../re/nextdimension/kernel/scripts/) — NeXTdimension kernel analysis pipeline

## Swarm Pipeline (`scripts/swarm/`)

Multi-agent LLM analysis pipeline for firmware function classification. Uses Claude via the Anthropic API or Agent SDK (Max subscription).

### Modules

| Module | Purpose |
|--------|---------|
| `orchestrate.py` | Main pipeline orchestrator — intent → verification → contrarian → synthesis |
| `schemas.py` | Strict schema validation for LLM responses (coercion + rejection) |
| `store.py` | SQLite-backed claim store with full provenance tracking |
| `report.py` | CLI reporter for per-run accept/revise/reject + token summaries |

### Usage

```bash
# Dry run (estimate tokens, no API calls)
python3 -m scripts.swarm.orchestrate <factpack_dir> --dry-run --backend max

# Production run via Max subscription (concurrency 2)
python3 -m scripts.swarm.orchestrate <factpack_dir> --backend max --concurrency 2

# Production run via API (concurrency 4)
python3 -m scripts.swarm.orchestrate <factpack_dir> --backend api --concurrency 4

# Report results
python3 -m scripts.swarm.report <claims.db> [--run RUN_ID]
```

### Input Format

The pipeline reads a **factpack** directory containing:
- `manifest.json` — function list with entry addresses, sizes, priority tags, and shard file paths
- `shards/` — per-function JSON files with disassembly, control flow, and context

Factpacks are generated by Ghidra headless scripts from the target binary.

### Output

All results are stored in a SQLite database (`claims.db`) within the factpack directory, plus a `run_summary.json` and optional `synthesis.json`.

## Delay Slot Pcode Warnings

Scripts that perform linear sweep produce `Pcode error ... Program does not contain referenced instruction` warnings. These are harmless — they occur when Ghidra's delay slot analysis references addresses that haven't been disassembled or fall in data regions. The instructions themselves decode correctly.
